# 재무제표 시각화 웹 어플리케이션 가이드

## 📚 목차

1. [시작하기](#시작하기)
2. [기능 소개](#기능-소개)
3. [사용 방법](#사용-방법)
4. [API 엔드포인트](#api-엔드포인트)
5. [문제 해결](#문제-해결)

## 🚀 시작하기

### 1단계: 사전 준비

웹 어플리케이션을 실행하기 전에 다음 사항을 완료해야 합니다:

#### ✅ 회사 코드 다운로드

```bash
python download_corp_code.py
```

이 명령어는 `data/corp_codes.json` 파일을 생성합니다. 웹 어플리케이션은 이 파일을 데이터베이스로 사용합니다.

#### ✅ 환경 변수 설정

`.env` 파일에 OpenDart API 키가 설정되어 있는지 확인:

```
OPENDART_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### ✅ 의존성 설치

```bash
pip install -r requirements.txt
```

필수 패키지:
- `flask`: 웹 서버
- `flask-cors`: CORS 지원
- `requests`: HTTP 요청
- `python-dotenv`: 환경 변수 관리

### 2단계: 서버 실행

```bash
python app.py
```

**예상 출력:**

```
============================================================
🚀 재무제표 시각화 웹 어플리케이션 시작
============================================================
✅ 80,000개의 회사 정보를 로드했습니다.

📊 서버 시작: http://localhost:5000
   Ctrl+C 를 눌러 종료할 수 있습니다.
```

### 3단계: 브라우저 접속

웹 브라우저에서 다음 주소로 접속:

```
http://localhost:5000
```

또는 다른 기기에서 접속하려면:

```
http://[서버IP주소]:5000
```

## ✨ 기능 소개

### 1. 회사 검색

- **실시간 자동완성**: 2글자 이상 입력 시 자동으로 검색
- **다양한 검색 방법**: 회사명(한글/영문) 또는 종목코드
- **상장 여부 표시**: 상장/비상장 구분 배지

**예시:**
- "삼성" 입력 → 삼성전자, 삼성물산 등 표시
- "005930" 입력 → 삼성전자 표시

### 2. 재무제표 조회 옵션

#### 사업연도
- 2015년부터 현재까지 선택 가능
- OpenDart는 2015년 이후 데이터만 제공

#### 보고서 유형
- **사업보고서 (11011)**: 연간 보고서 (전전기 포함)
- **반기보고서 (11012)**: 중간 결산
- **1분기보고서 (11013)**: 1분기 결산
- **3분기보고서 (11014)**: 3분기 결산

#### 재무제표 구분
- **연결재무제표 (CFS)**: 자회사 포함
- **개별재무제표 (OFS)**: 별도 재무제표

### 3. 시각화 차트

#### 📊 재무상태표 (Balance Sheet)
- **표시 항목**: 자산총계, 부채총계, 자본총계
- **비교**: 당기 vs 전기
- **차트 유형**: 막대 그래프

#### 💰 손익계산서 (Income Statement)
- **표시 항목**: 매출액, 영업이익, 당기순이익
- **비교**: 당기 vs 전기
- **차트 유형**: 막대 그래프

#### 📉 연도별 추이
- **표시 항목**: 매출액, 당기순이익
- **기간**: 전전기 → 전기 → 당기 (사업보고서만 전전기 포함)
- **차트 유형**: 라인 그래프

### 4. 상세 데이터 테이블

- 모든 계정과목의 상세 금액
- 당기, 전기, 전전기 비교
- 재무상태표/손익계산서 탭 전환
- 금액은 억 단위로 표시

## 📖 사용 방법

### 기본 사용 흐름

```
1. 회사 검색
   ↓
2. 검색 결과에서 회사 선택
   ↓
3. 사업연도 선택
   ↓
4. 보고서 유형 선택
   ↓
5. 재무제표 구분 선택 (연결/개별)
   ↓
6. "조회하기" 버튼 클릭
   ↓
7. 차트 및 데이터 확인
```

### 상세 사용 예시

#### 예시 1: 삼성전자 2023년 사업보고서 조회

1. 검색창에 "삼성전자" 입력
2. 드롭다운에서 "삼성전자 (005930)" 선택
3. 사업연도: "2023년" 선택
4. 보고서 유형: "사업보고서" (기본값)
5. 재무제표 구분: "연결재무제표" (기본값)
6. "조회하기" 클릭

**결과:**
- 재무상태표 차트: 2023년 vs 2022년 비교
- 손익계산서 차트: 2023년 vs 2022년 비교
- 추세 그래프: 2021년 → 2022년 → 2023년
- 상세 테이블: 모든 계정과목 표시

#### 예시 2: 현대차 2023년 1분기 개별재무제표

1. "현대차" 검색 및 선택
2. 사업연도: "2023년"
3. 보고서 유형: "1분기보고서"
4. 재무제표 구분: "개별재무제표"
5. "조회하기" 클릭

## 🔌 API 엔드포인트

웹 어플리케이션은 다음 REST API를 제공합니다:

### 1. 회사 검색

```
GET /api/search?q={keyword}&limit={limit}
```

**Parameters:**
- `q` (필수): 검색 키워드
- `limit` (선택): 최대 결과 수 (기본값: 10)

**Response:**
```json
[
  {
    "corp_code": "00126380",
    "corp_name": "삼성전자",
    "stock_code": "005930",
    "is_listed": true
  }
]
```

### 2. 재무제표 조회

```
GET /api/financial-statement?corp_code={code}&bsns_year={year}&reprt_code={code}
```

**Parameters:**
- `corp_code` (필수): 회사 고유번호 (8자리)
- `bsns_year` (필수): 사업연도 (4자리)
- `reprt_code` (필수): 보고서 코드 (11011, 11012, 11013, 11014)

**Response:**
```json
{
  "balance_sheet": {
    "cfs": [...],
    "ofs": [...]
  },
  "income_statement": {
    "cfs": [...],
    "ofs": [...]
  },
  "metadata": {
    "rcept_no": "20190401004781",
    "bsns_year": "2023",
    "corp_code": "00126380",
    "stock_code": "005930",
    "reprt_code": "11011",
    "reprt_name": "사업보고서"
  }
}
```

### 3. 서버 상태 확인

```
GET /api/health
```

**Response:**
```json
{
  "status": "ok",
  "companies_loaded": 80000,
  "api_key_configured": true
}
```

## ❓ 문제 해결

### 서버가 시작되지 않음

**증상:**
```
❌ 서버를 시작할 수 없습니다.
   먼저 'python download_corp_code.py'를 실행하여 회사 데이터를 다운로드하세요.
```

**해결 방법:**
1. `data/corp_codes.json` 파일이 있는지 확인
2. 없다면 `python download_corp_code.py` 실행

### "조회된 데이터가 없습니다" 오류

**원인:**
- 선택한 연도/보고서 유형의 데이터가 존재하지 않음
- 회사가 해당 시기에 보고서를 제출하지 않음

**해결 방법:**
- 다른 연도 선택
- 사업보고서(연간)로 변경

### 차트가 표시되지 않음

**원인:**
- JavaScript 에러
- Chart.js 라이브러리 로드 실패

**해결 방법:**
1. 브라우저 콘솔 확인 (F12)
2. 인터넷 연결 확인 (Chart.js는 CDN에서 로드)
3. 페이지 새로고침 (Ctrl+F5)

### API 키 오류

**증상:**
```
OpenDart API 오류: 등록되지 않은 키입니다.
```

**해결 방법:**
1. `.env` 파일에 API 키가 올바르게 설정되었는지 확인
2. API 키 앞뒤에 공백이 없는지 확인
3. [OpenDart](https://opendart.fss.or.kr/)에서 키 상태 확인

### 포트 5000이 이미 사용 중

**증상:**
```
OSError: [Errno 48] Address already in use
```

**해결 방법:**

**Windows:**
```powershell
# 포트 사용 프로세스 확인
netstat -ano | findstr :5000

# 프로세스 종료 (PID 확인 후)
taskkill /PID [프로세스ID] /F
```

**Mac/Linux:**
```bash
# 포트 사용 프로세스 확인
lsof -i :5000

# 프로세스 종료
kill -9 [PID]
```

또는 `app.py`에서 다른 포트 사용:
```python
app.run(debug=True, host='0.0.0.0', port=5001)
```

## 💡 팁과 트릭

### 1. 여러 회사 비교

여러 브라우저 탭을 열어 다른 회사의 재무제표를 동시에 비교할 수 있습니다.

### 2. 데이터 다운로드

차트 위에서 마우스 오른쪽 클릭 → "이미지로 저장"으로 차트를 저장할 수 있습니다.

### 3. 테이블 데이터 복사

테이블에서 원하는 데이터를 선택하여 복사 후 Excel에 붙여넣기 가능합니다.

### 4. 모바일 사용

스마트폰 브라우저에서도 정상 작동합니다. 반응형 디자인이 적용되어 있습니다.

## 🔧 고급 설정

### 디버그 모드 비활성화

운영 환경에서는 `app.py`의 디버그 모드를 비활성화하세요:

```python
app.run(debug=False, host='0.0.0.0', port=5000)
```

### 외부 접근 허용

다른 기기에서 접속하려면:

1. 방화벽에서 5000번 포트 허용
2. 서버 IP 주소 확인:
   ```bash
   # Windows
   ipconfig
   
   # Mac/Linux
   ifconfig
   ```
3. 다른 기기에서 `http://[서버IP]:5000` 접속

### 로그 설정

더 자세한 로그를 보려면 `app.py`에 추가:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 📝 참고 자료

- [Flask 공식 문서](https://flask.palletsprojects.com/)
- [Chart.js 공식 문서](https://www.chartjs.org/)
- [OpenDart API 가이드](https://opendart.fss.or.kr/guide/main.do)

---

**문의사항이 있으시면 이슈를 등록해주세요!** 🙋‍♂️

