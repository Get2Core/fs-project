# 🚀 재무제표 시각화 앱 - 배포 완벽 가이드

## ✅ 배포 전 체크리스트

모든 문제가 해결되었으니 배포 준비가 완료되었습니다!

### 확인 완료 항목
- ✅ API 키 정상 작동 확인 (test_gemini.py 성공)
- ✅ AI 설명 완전 표시 (잘림 현상 해결)
- ✅ SQLite 데이터베이스 정상 작동
- ✅ 로컬 테스트 완료

---

## 🎯 추천 배포 방법: Render (무료)

**장점**:
- ✅ 완전 무료 (무료 플랜 제공)
- ✅ 자동 HTTPS
- ✅ GitHub 자동 배포
- ✅ 초보자 친화적
- ✅ 설정 간단

---

## 📋 Step 1: GitHub 준비

### 1-1. .gitignore 확인 및 업데이트

```bash
# .gitignore 파일 확인 (이미 있다면 스킵)
```

중요한 파일들이 제외되었는지 확인:
```gitignore
# 환경 변수 (절대 커밋 금지!)
.env

# 가상환경
venv/
env/

# Python
__pycache__/
*.pyc
*.pyo

# 데이터 (배포 시 자동 생성)
data/corp_codes.db
data/CORPCODE.xml
data/corpCode.zip
data/corp_codes.json

# 로그
ai_error_log.txt
*.log

# IDE
.vscode/
.idea/
```

### 1-2. GitHub 저장소 생성 및 푸시

```bash
# 1. GitHub에서 새 저장소 생성 (Public 또는 Private)
#    https://github.com/new

# 2. 로컬에서 Git 초기화 (아직 안 했다면)
git init

# 3. 파일 추가
git add .

# 4. 첫 커밋
git commit -m "Ready for deployment: Financial Statement Visualization App"

# 5. GitHub 저장소 연결
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git

# 6. 푸시
git branch -M main
git push -u origin main
```

---

## 🌐 Step 2: Render 배포

### 2-1. Render 계정 생성

1. https://render.com 접속
2. **"Get Started"** 클릭
3. **GitHub로 가입** (추천)
4. GitHub 연동 승인

### 2-2. 새 Web Service 생성

1. Render 대시보드에서 **"New +"** 클릭
2. **"Web Service"** 선택
3. GitHub 저장소 연결:
   - 저장소 선택: `YOUR_USERNAME/YOUR_REPO_NAME`
   - **"Connect"** 클릭

### 2-3. 서비스 설정

#### 기본 설정

| 항목 | 값 | 설명 |
|------|-----|------|
| **Name** | `financial-statement-app` | 원하는 이름 (URL에 사용됨) |
| **Region** | `Singapore` 또는 `Oregon` | 한국과 가까운 지역 선택 |
| **Branch** | `main` | 배포할 브랜치 |
| **Root Directory** | (비워둠) | 프로젝트 루트 사용 |
| **Runtime** | `Python 3` | 자동 감지됨 |

#### 빌드 명령 (Build Command)

**중요!** 다음을 정확히 복사:

```bash
pip install -r requirements.txt && python download_corp_code.py && python init_db.py
```

**설명**:
1. `pip install -r requirements.txt` - 패키지 설치
2. `python download_corp_code.py` - CSV 데이터 다운로드
3. `python init_db.py` - SQLite 데이터베이스 생성 ⚡ 필수!

#### 시작 명령 (Start Command)

```bash
gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120
```

**설명**:
- `--workers 2`: 동시 처리 (무료 플랜 제한)
- `--timeout 120`: AI 응답 대기 시간

### 2-4. 환경 변수 설정

**매우 중요!** API 키를 설정해야 합니다.

1. Render 설정 화면에서 **"Environment"** 섹션으로 스크롤
2. **"Add Environment Variable"** 클릭

#### 필수 환경 변수

| Key | Value | 설명 |
|-----|-------|------|
| `OPENDART_API_KEY` | `당신의_OpenDart_API_키` | OpenDart API 키 |
| `GEMINI_API_KEY` | `당신의_Gemini_API_키` | Google Gemini API 키 |
| `PYTHONIOENCODING` | `utf-8` | 인코딩 설정 (Windows) |

**주의**: `.env` 파일의 키를 그대로 복사하되, 따옴표는 제거!

```bash
# ❌ 잘못된 예
GEMINI_API_KEY="AIzaSy..."

# ✅ 올바른 예
GEMINI_API_KEY=AIzaSy...
```

### 2-5. 배포 시작

1. 모든 설정 확인
2. **"Create Web Service"** 클릭
3. 배포 로그 확인 (5-10분 소요)

#### 예상 로그

```
==> Cloning from https://github.com/...
==> Checking out commit ...
==> Running build command...
==> Installing dependencies from requirements.txt
==> Downloading corp codes...
==> Initializing SQLite database...
✅ 데이터베이스 초기화 완료: 114,595개 회사
==> Build successful!
==> Starting service...
✅ Gemini API 초기화 완료 (모델: gemini-2.5-flash)
==> Service is live at https://financial-statement-app.onrender.com
```

---

## ✅ Step 3: 배포 확인

### 3-1. URL 접속

배포 완료 후 URL이 표시됩니다:
```
https://YOUR-APP-NAME.onrender.com
```

### 3-2. 기능 테스트

1. **회사 검색**
   - "삼성전자" 검색
   - 결과가 표시되는지 확인

2. **재무제표 조회**
   - 회사 선택
   - 차트가 표시되는지 확인

3. **AI 설명 생성**
   - "AI로 재무제표 설명 생성" 버튼 클릭
   - 설명이 완전히 표시되는지 확인 (잘리지 않음)

### 3-3. 로그 확인

Render 대시보드에서:
1. **"Logs"** 탭 클릭
2. 실시간 로그 확인

**정상 로그**:
```
✅ Gemini API 초기화 완료 (모델: gemini-2.5-flash)
✅ 데이터베이스 연결 확인: 114,595개 회사 데이터 로드됨
🚀 서버 시작: 0.0.0.0:10000
```

---

## 🔧 Step 4: 추가 설정 (선택사항)

### 4-1. 커스텀 도메인 (무료!)

1. Render 대시보드에서 **"Settings"** 탭
2. **"Custom Domain"** 섹션
3. 도메인 추가 (있다면)
   - 예: `financials.yourdomain.com`
4. DNS 설정 안내 따르기

### 4-2. Auto-Deploy 설정

- GitHub에 푸시하면 자동 배포 (기본값: ON)
- **"Settings"** → **"Build & Deploy"**에서 확인

### 4-3. Sleep 방지 (무료 플랜)

무료 플랜은 15분 미활동 시 Sleep 모드:

**해결책 1**: 주기적 핑
```javascript
// 외부 서비스 사용 (UptimeRobot 등)
```

**해결책 2**: 유료 플랜 ($7/월)
- Sleep 없음
- 더 많은 리소스

---

## 📊 성능 최적화

### 5-1. 무료 플랜 제한

| 항목 | 무료 플랜 | 유료 플랫 ($7/월) |
|------|-----------|-------------------|
| RAM | 512MB | 2GB |
| CPU | 공유 | 전용 |
| Sleep | 15분 후 | 없음 |
| 동시 연결 | 제한 | 무제한 |

### 5-2. 최적화 팁

1. **Worker 수 조정**
   ```bash
   # 무료: workers 1-2
   # 유료: workers 4
   gunicorn app:app --workers 2
   ```

2. **타임아웃 증가** (AI 응답 대기)
   ```bash
   --timeout 120
   ```

3. **데이터베이스 최적화** (이미 완료!)
   - ✅ SQLite 사용
   - ✅ 인덱스 설정
   - ✅ 114,595개 회사 빠른 검색

---

## 🐛 문제 해결

### 문제 1: Build Failed

**증상**:
```
ERROR: Could not install packages
```

**해결**:
1. `requirements.txt` 확인
2. Python 버전 확인 (`runtime.txt`)
   ```
   python-3.11.7
   ```

### 문제 2: API Key Error

**증상**:
```
⚠️ GEMINI_API_KEY가 설정되지 않았습니다
```

**해결**:
1. Render 대시보드 → **"Environment"**
2. 환경 변수 다시 확인
3. 따옴표 제거했는지 확인
4. **"Manual Deploy"** → **"Deploy latest commit"**

### 문제 3: Database Not Found

**증상**:
```
❌ 데이터베이스 파일이 없습니다
```

**해결**:
1. Build Command 확인:
   ```bash
   pip install -r requirements.txt && python download_corp_code.py && python init_db.py
   ```
2. 로그에서 "데이터베이스 초기화 완료" 메시지 확인
3. 없다면 **"Manual Deploy"** 재실행

### 문제 4: AI 설명 느림

**증상**: AI 버튼 클릭 후 30초+ 소요

**원인**: 
- 무료 플랫폼 리소스 제한
- Gemini API 응답 시간

**해결**:
- 정상 (첫 요청은 느림, Cold Start)
- 이후 요청은 더 빠름
- 유료 플랜 고려

---

## 🎉 배포 완료!

### 최종 체크리스트

- ✅ GitHub 저장소 생성 및 푸시
- ✅ Render 계정 생성
- ✅ Web Service 생성
- ✅ Build Command 설정
- ✅ Start Command 설정
- ✅ 환경 변수 설정 (API 키)
- ✅ 배포 성공 확인
- ✅ URL 접속 테스트
- ✅ 기능 테스트 (검색, 차트, AI)

### 🌐 배포 URL

```
https://YOUR-APP-NAME.onrender.com
```

이 URL을 공유하면 누구나 사용할 수 있습니다!

---

## 📞 추가 지원

### 다른 플랫폼 배포

관심 있으시면 다음도 가능합니다:

1. **Railway** - Render와 유사, 더 많은 무료 리소스
2. **Fly.io** - 글로벌 배포, 빠른 속도
3. **AWS EC2** - 완전 제어 가능, 복잡함
4. **Docker** - 컨테이너 배포, 이식성 높음

### 도움이 필요하면

- Render 로그 확인
- 오류 메시지 공유
- GitHub Issues 활용

**축하합니다! 배포 준비 완료입니다!** 🎊🚀

